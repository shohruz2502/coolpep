<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coolpep - Reels</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        
        body {
            background: #000;
            color: white;
            min-height: 100vh;
            overflow: hidden;
        }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è Reels */
        .reels-container {
            height: 100vh;
            position: relative;
            scroll-snap-type: y mandatory;
            overflow-y: scroll;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .reels-container::-webkit-scrollbar {
            display: none;
        }
        
        /* –û–¥–∏–Ω Reel */
        .reel {
            height: 100vh;
            width: 100%;
            scroll-snap-align: start;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 20px;
            background: linear-gradient(0deg, rgba(0,0,0,0.8) 0%, transparent 30%);
        }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤–∏–¥–µ–æ */
        .video-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }
        
        .video-element {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: #000;
        }
        
        /* –ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –∏ –∑–∞–≥—Ä—É–∑–∫–∞ */
        .video-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
            flex-direction: column;
            gap: 15px;
            text-align: center;
            padding: 20px;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Reel */
        .reel-info {
            z-index: 2;
            margin-bottom: 80px;
        }
        
        .reel-author {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .author-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
            flex-shrink: 0;
        }
        
        .author-info {
            flex: 1;
        }
        
        .author-name {
            font-weight: 600;
            font-size: 16px;
            display: block;
        }
        
        .author-bio {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 2px;
        }
        
        .follow-button {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 6px 15px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: background 0.2s;
            white-space: nowrap;
        }
        
        .follow-button:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .reel-caption {
            font-size: 15px;
            line-height: 1.4;
            margin-bottom: 15px;
            max-width: 80%;
        }
        
        .reel-music {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: rgba(255,255,255,0.9);
            margin-bottom: 20px;
        }
        
        .music-icon {
            font-size: 16px;
        }
        
        /* –î–µ–π—Å—Ç–≤–∏—è —Å Reel */
        .reel-actions {
            position: absolute;
            right: 20px;
            bottom: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            z-index: 3;
        }
        
        .action-button {
            background: none;
            border: none;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .action-button:hover {
            transform: scale(1.1);
        }
        
        .action-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .action-count {
            font-size: 12px;
            font-weight: 500;
        }
        
        .action-button.liked .action-icon {
            background: rgba(255, 59, 48, 0.3);
            color: #ff3b30;
        }
        
        /* –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–ª—è Reels */
        .reels-progress {
            position: fixed;
            top: 10px;
            left: 20px;
            right: 20px;
            display: flex;
            gap: 4px;
            z-index: 100;
        }
        
        .progress-bar {
            flex: 1;
            height: 3px;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            width: 0%;
            background: white;
            transition: width 0.1s linear;
        }
        
        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
        .top-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 90;
            background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, transparent 100%);
        }
        
        .logo {
            font-size: 22px;
            font-weight: 800;
            color: white;
            letter-spacing: 1px;
            text-decoration: none;
        }
        
        .top-actions {
            display: flex;
            gap: 15px;
        }
        
        .top-action, .upload-action {
            font-size: 20px;
            color: white;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
            text-decoration: none;
        }
        
        .top-action:hover, .upload-action:hover {
            background: rgba(255,255,255,0.1);
        }
        
        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–µ–æ */
        .video-controls {
            position: absolute;
            bottom: 150px;
            left: 20px;
            display: flex;
            gap: 10px;
            z-index: 5;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .reel:hover .video-controls {
            opacity: 1;
        }
        
        .video-btn {
            background: rgba(0,0,0,0.5);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            backdrop-filter: blur(10px);
        }
        
        .video-muted {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            z-index: 5;
            backdrop-filter: blur(10px);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .reel:hover .video-muted {
            opacity: 1;
        }
        
        /* –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.8);
            padding: 15px 20px;
            display: flex;
            justify-content: space-around;
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255,255,255,0.1);
            z-index: 100;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: rgba(255,255,255,0.6);
            transition: color 0.2s;
            flex: 1;
            max-width: 80px;
        }
        
        .nav-item.active {
            color: white;
        }
        
        .nav-icon {
            font-size: 20px;
            margin-bottom: 5px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }
        
        .nav-item.active .nav-icon {
            background: rgba(255,255,255,0.1);
        }
        
        .nav-label {
            font-size: 11px;
            font-weight: 500;
        }
        
        /* –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è Reel */
        .create-reel-button {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.5);
            z-index: 90;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
            text-decoration: none;
        }
        
        .create-reel-button:hover {
            transform: scale(1.1);
        }
        
        /* –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ */
        .comments-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.95);
            border-radius: 20px 20px 0 0;
            padding: 20px;
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
            z-index: 200;
            max-height: 70vh;
            display: flex;
            flex-direction: column;
        }
        
        .comments-panel.active {
            transform: translateY(0);
        }
        
        .comments-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .comments-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .close-comments {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }
        
        .comments-list {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 15px;
        }
        
        .comment-item {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .comment-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            flex-shrink: 0;
        }
        
        .comment-content {
            flex: 1;
        }
        
        .comment-author {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 3px;
        }
        
        .comment-text {
            font-size: 14px;
            line-height: 1.4;
            color: rgba(255,255,255,0.9);
        }
        
        .comment-actions {
            display: flex;
            gap: 15px;
            margin-top: 5px;
        }
        
        .comment-action {
            background: none;
            border: none;
            color: rgba(255,255,255,0.6);
            font-size: 12px;
            cursor: pointer;
        }
        
        .comment-input-container {
            display: flex;
            gap: 10px;
            align-items: center;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .comment-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 25px;
            background: rgba(255,255,255,0.05);
            color: white;
            font-size: 14px;
        }
        
        .comment-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .comment-send {
            background: #667eea;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
        }
        
        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–≤—É–∫–∞ */
        .sound-indicator {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.5);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
            z-index: 5;
            backdrop-filter: blur(10px);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .reel:hover .sound-indicator {
            opacity: 1;
        }
        
        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .reel-stats {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            font-size: 12px;
            opacity: 0.8;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ */
        .error-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 59, 48, 0.9);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            text-align: center;
            z-index: 1000;
            display: none;
            backdrop-filter: blur(10px);
            max-width: 300px;
        }
        
        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loading-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            padding: 30px 40px;
            border-radius: 15px;
            text-align: center;
            z-index: 1000;
            display: none;
            backdrop-filter: blur(10px);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
        @media (max-width: 480px) {
            .reel {
                padding: 15px;
            }
            
            .reel-actions {
                right: 15px;
                bottom: 90px;
            }
            
            .action-icon {
                width: 44px;
                height: 44px;
                font-size: 22px;
            }
            
            .reel-caption {
                max-width: 85%;
            }
            
            .top-bar {
                padding: 12px 15px;
            }
            
            .bottom-nav {
                padding: 12px 15px;
            }
            
            .video-controls {
                bottom: 120px;
            }
        }
        
        /* –•—ç—à—Ç–µ–≥–∏ */
        .hashtag {
            color: #667eea;
            font-weight: 500;
            text-decoration: none;
        }
        
        .hashtag:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä Reels -->
    <div class="reels-progress" id="reelsProgress">
        <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è -->
    </div>
    
    <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
    <div class="top-bar">
        <a href="main-hub.html" class="logo">Reels</a>
        <div class="top-actions">
            <a href="upload-video.html" class="upload-action">üì§</a>
            <a href="#" class="top-action" onclick="openCamera()">üì∑</a>
            <a href="main-hub.html" class="top-action">üè†</a>
        </div>
    </div>
    
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä Reels -->
    <div class="reels-container" id="reelsContainer">
        <!-- Reels –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
    </div>
    
    <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è -->
    <a href="upload-video.html" class="create-reel-button">+</a>
    
    <!-- –ü–∞–Ω–µ–ª—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
    <div class="comments-panel" id="commentsPanel">
        <div class="comments-header">
            <div class="comments-title">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</div>
            <button class="close-comments" onclick="closeComments()">√ó</button>
        </div>
        
        <div class="comments-list" id="commentsList">
            <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
        </div>
        
        <div class="comment-input-container">
            <input type="text" class="comment-input" id="commentInput" placeholder="–î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π...">
            <button class="comment-send" onclick="sendComment()">‚û§</button>
        </div>
    </div>
    
    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ -->
    <div class="error-message" id="errorMessage"></div>
    
    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div class="loading-indicator" id="loadingIndicator">
        <div class="loading-spinner"></div>
        <p style="margin-top: 15px;">–ó–∞–≥—Ä—É–∑–∫–∞ Reels...</p>
    </div>
    
    <!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="bottom-nav">
        <a href="main-hub.html" class="nav-item">
            <div class="nav-icon">üè†</div>
            <div class="nav-label">–ì–ª–∞–≤–Ω–∞—è</div>
        </a>
        
        <a href="vastapae-feed.html" class="nav-item">
            <div class="nav-icon">üì±</div>
            <div class="nav-label">VASTAPAE</div>
        </a>
        
        <a href="friends-list.html" class="nav-item">
            <div class="nav-icon">üë•</div>
            <div class="nav-label">FRIEND</div>
        </a>
        
        <a href="reels-feed.html" class="nav-item active">
            <div class="nav-icon">üé¨</div>
            <div class="nav-label">REELS</div>
        </a>
        
        <a href="family-main.html" class="nav-item">
            <div class="nav-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
            <div class="nav-label">FAMILY</div>
        </a>
    </nav>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let reelsData = [];
        let currentReelIndex = 0;
        let playingVideo = null;
        let observer = null;
        let currentUser = null;
        let isLoading = false;
        let currentPage = 1;
        let hasMoreReels = true;
        
        // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)
        let comments = {};
        
        // –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–ª—è –¥–µ–º–æ
        const TEST_USERS = {
            '11111111-1111-1111-1111-111111111111': { name: '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤', avatar: 'üë®', bio: '–õ—é–±–ª—é –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –∏ —Å–ø–æ—Ä—Ç' },
            '22222222-2222-2222-2222-222222222222': { name: '–ê–Ω–Ω–∞ –ü–µ—Ç—Ä–æ–≤–∞', avatar: 'üë©', bio: '–ö–æ—Ñ–µ–º–∞–Ω –∏ –¥–∏–∑–∞–π–Ω–µ—Ä' },
            '33333333-3333-3333-3333-333333333333': { name: '–î–º–∏—Ç—Ä–∏–π –°–∏–¥–æ—Ä–æ–≤', avatar: 'üí™', bio: '–§–∏—Ç–Ω–µ—Å —Ç—Ä–µ–Ω–µ—Ä' },
            '44444444-4444-4444-4444-444444444444': { name: '–ú–∞—Ä–∏—è –ö–æ–∑–ª–æ–≤–∞', avatar: 'üé®', bio: '–•—É–¥–æ–∂–Ω–∏–∫ –∏ –∏–ª–ª—é—Å—Ç—Ä–∞—Ç–æ—Ä' },
            '55555555-5555-5555-5555-555555555555': { name: '–ê–ª–µ–∫—Å–µ–π –ù–æ–≤–∏–∫–æ–≤', avatar: 'üì∏', bio: '–§–æ—Ç–æ–≥—Ä–∞—Ñ –∏ –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫' },
            '66666666-6666-6666-6666-666666666666': { name: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞ –í–æ–ª–∫–æ–≤–∞', avatar: 'üíº', bio: '–ë–ª–æ–≥–µ—Ä –∏ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å' }
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ localStorage
            loadCurrentUser();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º Reels
            loadReelsFromAPI();
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π
            setupEventListeners();
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É —Ö—ç—à—Ç–µ–≥–æ–≤
            setupHashtagDetection();
        });
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function loadCurrentUser() {
            const savedUser = localStorage.getItem('coolpep_current_user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
            } else {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–≤–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                currentUser = {
                    id: '11111111-1111-1111-1111-111111111111',
                    name: '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤',
                    avatar: 'üë®'
                };
                localStorage.setItem('coolpep_current_user', JSON.stringify(currentUser));
            }
            
            console.log('–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', currentUser);
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ Reels —Å —Å–µ—Ä–≤–µ—Ä–∞
        async function loadReelsFromAPI() {
            if (isLoading || !hasMoreReels) return;
            
            isLoading = true;
            showLoading();
            
            try {
                // –§–æ—Ä–º–∏—Ä—É–µ–º URL —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
                const url = new URL('/api/reels/feed', window.location.origin);
                url.searchParams.append('page', currentPage);
                url.searchParams.append('limit', 5);
                if (currentUser) {
                    url.searchParams.append('userId', currentUser.id);
                }
                
                console.log('–ó–∞–≥—Ä—É–∑–∫–∞ Reels —Å URL:', url.toString());
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    console.log('–ü–æ–ª—É—á–µ–Ω–æ Reels:', data.reels.length);
                    
                    if (data.reels.length === 0) {
                        hasMoreReels = false;
                        if (currentPage === 1) {
                            // –ï—Å–ª–∏ –Ω–µ—Ç Reels, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ–º–æ
                            showNoReelsMessage();
                        }
                    } else {
                        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ Reels
                        reelsData = [...reelsData, ...data.reels];
                        
                        // –†–µ–Ω–¥–µ—Ä–∏–º Reels
                        if (currentPage === 1) {
                            renderReels();
                            setupIntersectionObserver();
                        } else {
                            appendReels(data.reels);
                        }
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –µ—â–µ Reels
                        if (data.reels.length < 5) {
                            hasMoreReels = false;
                        }
                        
                        currentPage++;
                    }
                } else {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Reels');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Reels:', error);
                showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Reels: ' + error.message);
                
                // –ï—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ
                if (currentPage === 1 && reelsData.length === 0) {
                    await loadDemoReels();
                }
            } finally {
                isLoading = false;
                hideLoading();
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ–º–æ Reels
        async function loadDemoReels() {
            console.log('–ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ');
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
            reelsData = [
                {
                    id: 'demo-1',
                    user_id: '11111111-1111-1111-1111-111111111111',
                    caption: '–£–¥–∏–≤–∏—Ç–µ–ª—å–Ω—ã–µ –≥–æ—Ä–Ω—ã–µ –ø–µ–π–∑–∞–∂–∏ –ù–æ—Ä–≤–µ–≥–∏–∏ üåÑ #–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è #–Ω–æ—Ä–≤–µ–≥–∏—è #–ø—Ä–∏—Ä–æ–¥–∞',
                    music: '–≠–ø–∏—á–Ω–∞—è –º—É–∑—ã–∫–∞ - Adventure',
                    likes_count: 12500,
                    views_count: 89000,
                    duration: 15,
                    created_at: new Date().toISOString(),
                    user_name: '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤',
                    user_surname: '',
                    user_avatar: 'üë®',
                    user_bio: '–õ—é–±–ª—é –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –∏ —Å–ø–æ—Ä—Ç',
                    is_liked: false,
                    actual_likes: 12500
                },
                {
                    id: 'demo-2',
                    user_id: '22222222-2222-2222-2222-222222222222',
                    caption: '–ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –∫–æ—Ñ–µ –¥–æ–º–∞ ‚òï #–∫–æ—Ñ–µ #—Ä–µ—Ü–µ–ø—Ç #—É—Ç—Ä–æ',
                    music: '—Ç—Ä–µ–Ω–¥ ‚Ä¢ morning vibe',
                    likes_count: 8700,
                    views_count: 45000,
                    duration: 12,
                    created_at: new Date(Date.now() - 86400000).toISOString(),
                    user_name: '–ê–Ω–Ω–∞ –ü–µ—Ç—Ä–æ–≤–∞',
                    user_surname: '',
                    user_avatar: 'üë©',
                    user_bio: '–ö–æ—Ñ–µ–º–∞–Ω –∏ –¥–∏–∑–∞–π–Ω–µ—Ä',
                    is_liked: true,
                    actual_likes: 8700
                },
                {
                    id: 'demo-3',
                    user_id: '33333333-3333-3333-3333-333333333333',
                    caption: '–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –Ω–∞ —Å–≤–µ–∂–µ–º –≤–æ–∑–¥—É—Ö–µ üí™ #—Å–ø–æ—Ä—Ç #–∑–¥–æ—Ä–æ–≤—å–µ #—Ñ–∏—Ç–Ω–µ—Å',
                    music: '—Ç—Ä–µ–Ω–¥ ‚Ä¢ workout motivation',
                    likes_count: 15600,
                    views_count: 120000,
                    duration: 18,
                    created_at: new Date(Date.now() - 172800000).toISOString(),
                    user_name: '–î–º–∏—Ç—Ä–∏–π –°–∏–¥–æ—Ä–æ–≤',
                    user_surname: '',
                    user_avatar: 'üí™',
                    user_bio: '–§–∏—Ç–Ω–µ—Å —Ç—Ä–µ–Ω–µ—Ä',
                    is_liked: false,
                    actual_likes: 15600
                }
            ];
            
            renderReels();
            setupIntersectionObserver();
        }
        
        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤—Å–µ—Ö —Ä–∏–ª—Å–æ–≤
        function renderReels() {
            const container = document.getElementById('reelsContainer');
            const progressContainer = document.getElementById('reelsProgress');
            
            container.innerHTML = '';
            progressContainer.innerHTML = '';
            
            reelsData.forEach((reel, index) => {
                // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
                const progressBar = document.createElement('div');
                progressBar.className = 'progress-bar';
                progressBar.innerHTML = '<div class="progress-fill"></div>';
                progressContainer.appendChild(progressBar);
                
                // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                const userInfo = TEST_USERS[reel.user_id] || {
                    name: reel.user_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                    avatar: reel.user_avatar || 'üë§',
                    bio: reel.user_bio || ''
                };
                
                // –°–æ–∑–¥–∞–µ–º —Ä–∏–ª—Å
                const reelElement = document.createElement('div');
                reelElement.className = 'reel';
                reelElement.dataset.reelId = reel.id;
                reelElement.dataset.index = index;
                
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ö—ç—à—Ç–µ–≥–∏ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏
                const captionWithHashtags = processHashtags(reel.caption || '');
                
                reelElement.innerHTML = `
                    <div class="video-container">
                        <video class="video-element" 
                               playsinline 
                               webkit-playsinline 
                               preload="metadata"
                               poster="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
                        </video>
                        <div class="video-placeholder">
                            <div class="loading-spinner"></div>
                            <div>–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ...</div>
                            <small style="opacity: 0.7;">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è</small>
                        </div>
                    </div>
                    <div class="sound-indicator">
                        <span class="music-icon">üéµ</span> ${reel.music || '–ë–µ–∑ –∑–≤—É–∫–∞'}
                    </div>
                    <button class="video-muted" onclick="toggleMute(this)">
                        <span class="mute-icon">üîá</span>
                    </button>
                    <div class="video-controls">
                        <button class="video-btn" onclick="togglePlay(this)">
                            <span class="play-icon">‚è∏Ô∏è</span>
                        </button>
                        <button class="video-btn" onclick="restartVideo(this)">
                            <span class="restart-icon">‚Üª</span>
                        </button>
                    </div>
                    <div class="reel-info">
                        <div class="reel-author">
                            <div class="author-avatar">${userInfo.avatar}</div>
                            <div class="author-info">
                                <div class="author-name">${userInfo.name}</div>
                                ${userInfo.bio ? `<div class="author-bio">${userInfo.bio}</div>` : ''}
                            </div>
                            <button class="follow-button" onclick="followUser('${reel.user_id}', '${userInfo.name}')">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è</button>
                        </div>
                        <div class="reel-caption">${captionWithHashtags}</div>
                        <div class="reel-music">
                            <span class="music-icon">üéµ</span>
                            <span>${reel.music || '–ë–µ–∑ –∑–≤—É–∫–∞'}</span>
                        </div>
                        <div class="reel-stats">
                            <div class="stat-item">
                                <span>üëÅÔ∏è</span>
                                <span>${formatNumber(reel.views_count || 0)} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</span>
                            </div>
                            <div class="stat-item">
                                <span>‚è±Ô∏è</span>
                                <span>${reel.duration || 15} —Å–µ–∫</span>
                            </div>
                        </div>
                    </div>
                    <div class="reel-actions">
                        <button class="action-button ${reel.is_liked ? 'liked' : ''}" onclick="likeReel(this, '${reel.id}')">
                            <div class="action-icon">‚ù§Ô∏è</div>
                            <div class="action-count">${formatNumber(reel.actual_likes || reel.likes_count || 0)}</div>
                        </button>
                        <button class="action-button" onclick="openComments('${reel.id}')">
                            <div class="action-icon">üí¨</div>
                            <div class="action-count">0</div>
                        </button>
                        <button class="action-button" onclick="shareReel('${reel.id}')">
                            <div class="action-icon">üîÅ</div>
                            <div class="action-count">0</div>
                        </button>
                        <button class="action-button" onclick="saveReel(this, '${reel.id}')">
                            <div class="action-icon">üì•</div>
                            <div class="action-count"></div>
                        </button>
                    </div>
                `;
                
                container.appendChild(reelElement);
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∏–¥–µ–æ –¥–ª—è —ç—Ç–æ–≥–æ —Ä–∏–ª—Å–∞
                loadVideoForReel(reelElement, reel.id);
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
            updateProgressBar();
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö Reels
        function appendReels(newReels) {
            const container = document.getElementById('reelsContainer');
            const progressContainer = document.getElementById('reelsProgress');
            
            newReels.forEach((reel, index) => {
                const actualIndex = reelsData.length - newReels.length + index;
                
                // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
                const progressBar = document.createElement('div');
                progressBar.className = 'progress-bar';
                progressBar.innerHTML = '<div class="progress-fill"></div>';
                progressContainer.appendChild(progressBar);
                
                // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                const userInfo = TEST_USERS[reel.user_id] || {
                    name: reel.user_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                    avatar: reel.user_avatar || 'üë§',
                    bio: reel.user_bio || ''
                };
                
                // –°–æ–∑–¥–∞–µ–º —Ä–∏–ª—Å
                const reelElement = document.createElement('div');
                reelElement.className = 'reel';
                reelElement.dataset.reelId = reel.id;
                reelElement.dataset.index = actualIndex;
                
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ö—ç—à—Ç–µ–≥–∏ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏
                const captionWithHashtags = processHashtags(reel.caption || '');
                
                reelElement.innerHTML = `
                    <div class="video-container">
                        <video class="video-element" 
                               playsinline 
                               webkit-playsinline 
                               preload="metadata"
                               poster="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
                        </video>
                        <div class="video-placeholder">
                            <div class="loading-spinner"></div>
                            <div>–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ...</div>
                            <small style="opacity: 0.7;">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è</small>
                        </div>
                    </div>
                    <div class="sound-indicator">
                        <span class="music-icon">üéµ</span> ${reel.music || '–ë–µ–∑ –∑–≤—É–∫–∞'}
                    </div>
                    <button class="video-muted" onclick="toggleMute(this)">
                        <span class="mute-icon">üîá</span>
                    </button>
                    <div class="video-controls">
                        <button class="video-btn" onclick="togglePlay(this)">
                            <span class="play-icon">‚è∏Ô∏è</span>
                        </button>
                        <button class="video-btn" onclick="restartVideo(this)">
                            <span class="restart-icon">‚Üª</span>
                        </button>
                    </div>
                    <div class="reel-info">
                        <div class="reel-author">
                            <div class="author-avatar">${userInfo.avatar}</div>
                            <div class="author-info">
                                <div class="author-name">${userInfo.name}</div>
                                ${userInfo.bio ? `<div class="author-bio">${userInfo.bio}</div>` : ''}
                            </div>
                            <button class="follow-button" onclick="followUser('${reel.user_id}', '${userInfo.name}')">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è</button>
                        </div>
                        <div class="reel-caption">${captionWithHashtags}</div>
                        <div class="reel-music">
                            <span class="music-icon">üéµ</span>
                            <span>${reel.music || '–ë–µ–∑ –∑–≤—É–∫–∞'}</span>
                        </div>
                        <div class="reel-stats">
                            <div class="stat-item">
                                <span>üëÅÔ∏è</span>
                                <span>${formatNumber(reel.views_count || 0)} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</span>
                            </div>
                            <div class="stat-item">
                                <span>‚è±Ô∏è</span>
                                <span>${reel.duration || 15} —Å–µ–∫</span>
                            </div>
                        </div>
                    </div>
                    <div class="reel-actions">
                        <button class="action-button ${reel.is_liked ? 'liked' : ''}" onclick="likeReel(this, '${reel.id}')">
                            <div class="action-icon">‚ù§Ô∏è</div>
                            <div class="action-count">${formatNumber(reel.actual_likes || reel.likes_count || 0)}</div>
                        </button>
                        <button class="action-button" onclick="openComments('${reel.id}')">
                            <div class="action-icon">üí¨</div>
                            <div class="action-count">0</div>
                        </button>
                        <button class="action-button" onclick="shareReel('${reel.id}')">
                            <div class="action-icon">üîÅ</div>
                            <div class="action-count">0</div>
                        </button>
                        <button class="action-button" onclick="saveReel(this, '${reel.id}')">
                            <div class="action-icon">üì•</div>
                            <div class="action-count"></div>
                        </button>
                    </div>
                `;
                
                container.appendChild(reelElement);
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∏–¥–µ–æ –¥–ª—è —ç—Ç–æ–≥–æ —Ä–∏–ª—Å–∞
                loadVideoForReel(reelElement, reel.id);
            });
            
            // –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º observer –¥–ª—è –Ω–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            if (observer) {
                document.querySelectorAll('.reel').forEach(reel => {
                    if (!reel.dataset.observed) {
                        observer.observe(reel);
                        reel.dataset.observed = 'true';
                    }
                });
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–∏–ª—Å–∞
        async function loadVideoForReel(reelElement, reelId) {
            try {
                // –ï—Å–ª–∏ —ç—Ç–æ –¥–µ–º–æ —Ä–∏–ª—Å, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É
                if (reelId.startsWith('demo-')) {
                    // –î–ª—è –¥–µ–º–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤–∏–¥–µ–æ-–∑–∞–≥–ª—É—à–∫—É
                    const placeholder = reelElement.querySelector('.video-placeholder');
                    const video = reelElement.querySelector('.video-element');
                    
                    // –°–æ–∑–¥–∞–µ–º –∫–æ—Ä–æ—Ç–∫–æ–µ –¥–µ–º–æ –≤–∏–¥–µ–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ
                    const canvas = document.createElement('canvas');
                    canvas.width = 640;
                    canvas.height = 360;
                    const ctx = canvas.getContext('2d');
                    
                    // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω
                    const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                    gradient.addColorStop(0, '#667eea');
                    gradient.addColorStop(1, '#764ba2');
                    ctx.fillStyle = gradient;
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 24px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('Demo Video', canvas.width/2, canvas.height/2);
                    ctx.font = '16px Arial';
                    ctx.fillText('–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞', canvas.width/2, canvas.height/2 + 30);
                    
                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ data URL
                    const dataUrl = canvas.toDataURL('image/jpeg');
                    
                    // –°–æ–∑–¥–∞–µ–º –≤–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
                    video.poster = dataUrl;
                    
                    placeholder.innerHTML = `
                        <div style="text-align: center;">
                            <div style="font-size: 20px; margin-bottom: 10px;">üé¨</div>
                            <div>–î–µ–º–æ –≤–∏–¥–µ–æ</div>
                            <small style="opacity: 0.7;">–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</small>
                        </div>
                    `;
                    
                    placeholder.style.cursor = 'pointer';
                    placeholder.onclick = () => {
                        // –ü—Ä–∏ –∫–ª–∏–∫–µ —Å–æ–∑–¥–∞–µ–º –∫–æ—Ä–æ—Ç–∫–æ–µ –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤–∏–¥–µ–æ
                        animateDemoVideo(video, canvas, ctx);
                    };
                    
                    return;
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∏–¥–µ–æ —Å —Å–µ—Ä–≤–µ—Ä–∞
                const response = await fetch(`/api/reels/${reelId}/video`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    const video = reelElement.querySelector('.video-element');
                    const placeholder = reelElement.querySelector('.video-placeholder');
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ –≤–∏–¥–µ–æ
                    video.src = data.video;
                    
                    // –ö–æ–≥–¥–∞ –≤–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ, —Å–∫—Ä—ã–≤–∞–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä
                    video.onloadeddata = () => {
                        placeholder.style.display = 'none';
                    };
                    
                    video.onerror = () => {
                        placeholder.innerHTML = '<div>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ</div>';
                    };
                } else {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ:', error);
                const placeholder = reelElement.querySelector('.video-placeholder');
                placeholder.innerHTML = `
                    <div style="text-align: center;">
                        <div style="font-size: 20px; margin-bottom: 10px;">üé¨</div>
                        <div>–î–µ–º–æ –∫–æ–Ω—Ç–µ–Ω—Ç</div>
                        <small style="opacity: 0.7;">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</small>
                    </div>
                `;
                placeholder.style.cursor = 'pointer';
                placeholder.onclick = () => {
                    createDemoVideo(reelElement);
                };
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –¥–µ–º–æ –≤–∏–¥–µ–æ
        function createDemoVideo(reelElement) {
            const video = reelElement.querySelector('.video-element');
            const placeholder = reelElement.querySelector('.video-placeholder');
            
            // –°–æ–∑–¥–∞–µ–º canvas –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
            const canvas = document.createElement('canvas');
            canvas.width = 640;
            canvas.height = 360;
            const ctx = canvas.getContext('2d');
            
            // –ê–Ω–∏–º–∏—Ä—É–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç
            let angle = 0;
            function animate() {
                angle += 0.02;
                
                // –û—á–∏—â–∞–µ–º canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // –°–æ–∑–¥–∞–µ–º –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç
                const gradient = ctx.createLinearGradient(
                    Math.cos(angle) * canvas.width,
                    Math.sin(angle) * canvas.height,
                    Math.cos(angle + Math.PI) * canvas.width,
                    Math.sin(angle + Math.PI) * canvas.height
                );
                gradient.addColorStop(0, '#667eea');
                gradient.addColorStop(0.5, '#764ba2');
                gradient.addColorStop(1, '#667eea');
                
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç
                ctx.fillStyle = 'white';
                ctx.font = 'bold 24px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('–î–µ–º–æ –∞–Ω–∏–º–∞—Ü–∏—è', canvas.width/2, canvas.height/2);
                ctx.font = '16px Arial';
                ctx.fillText('Coolpep Reels', canvas.width/2, canvas.height/2 + 30);
                
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ data URL –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞–∫ poster
                video.poster = canvas.toDataURL('image/jpeg');
                
                requestAnimationFrame(animate);
            }
            
            animate();
            
            placeholder.style.display = 'none';
        }
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –¥–µ–º–æ –≤–∏–¥–µ–æ
        function animateDemoVideo(video, canvas, ctx) {
            let angle = 0;
            let frames = 0;
            const totalFrames = 60; // 2 —Å–µ–∫—É–Ω–¥—ã –ø—Ä–∏ 30fps
            
            function animateFrame() {
                if (frames >= totalFrames) {
                    // –ó–∞–≤–µ—Ä—à–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
                    const placeholder = video.closest('.video-container').querySelector('.video-placeholder');
                    placeholder.innerHTML = `
                        <div style="text-align: center;">
                            <div style="font-size: 20px; margin-bottom: 10px;">‚úÖ</div>
                            <div>–î–µ–º–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ</div>
                            <small style="opacity: 0.7;">–ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –¥–∞–ª—å—à–µ</small>
                        </div>
                    `;
                    placeholder.style.display = 'flex';
                    return;
                }
                
                angle += 0.1;
                frames++;
                
                // –û—á–∏—â–∞–µ–º canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // –°–æ–∑–¥–∞–µ–º –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç
                const gradient = ctx.createLinearGradient(
                    Math.cos(angle) * canvas.width,
                    Math.sin(angle) * canvas.height,
                    Math.cos(angle + Math.PI) * canvas.width,
                    Math.sin(angle + Math.PI) * canvas.height
                );
                gradient.addColorStop(0, '#667eea');
                gradient.addColorStop(0.5, '#764ba2');
                gradient.addColorStop(1, '#667eea');
                
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
                ctx.fillStyle = 'white';
                ctx.font = 'bold 24px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('–î–µ–º–æ –≤–∏–¥–µ–æ', canvas.width/2, canvas.height/2 - 20);
                ctx.font = '16px Arial';
                ctx.fillText(`–ü—Ä–æ–≥—Ä–µ—Å—Å: ${Math.round((frames / totalFrames) * 100)}%`, canvas.width/2, canvas.height/2 + 20);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä
                ctx.fillStyle = 'rgba(255,255,255,0.3)';
                ctx.fillRect(canvas.width/2 - 100, canvas.height/2 + 40, 200, 10);
                ctx.fillStyle = 'white';
                ctx.fillRect(canvas.width/2 - 100, canvas.height/2 + 40, (frames / totalFrames) * 200, 10);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º poster
                video.poster = canvas.toDataURL('image/jpeg');
                
                requestAnimationFrame(animateFrame);
            }
            
            animateFrame();
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Intersection Observer
        function setupIntersectionObserver() {
            const options = {
                root: null,
                rootMargin: '0px',
                threshold: 0.7
            };
            
            observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const reel = entry.target;
                    const video = reel.querySelector('.video-element');
                    const placeholder = reel.querySelector('.video-placeholder');
                    
                    if (entry.isIntersecting) {
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç—Ç–æ—Ç —Ä–∏–ª—Å
                        currentReelIndex = parseInt(reel.dataset.index);
                        updateProgressBar();
                        
                        // –ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
                        if (video && video.poster && !video.src) {
                            // –î–ª—è –¥–µ–º–æ –≤–∏–¥–µ–æ –ø—Ä–æ—Å—Ç–æ —Å–∫—Ä—ã–≤–∞–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä
                            placeholder.style.display = 'none';
                        }
                        
                    } else {
                        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∏–¥–µ–æ, –µ—Å–ª–∏ –Ω–µ –≤ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏
                        if (video) {
                            video.pause();
                        }
                    }
                });
            }, options);
            
            document.querySelectorAll('.reel').forEach(reel => {
                observer.observe(reel);
                reel.dataset.observed = 'true';
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
        function updateProgressBar() {
            const progressBars = document.querySelectorAll('.progress-fill');
            
            progressBars.forEach((bar, index) => {
                if (index === currentReelIndex) {
                    bar.style.width = '100%';
                } else if (index < currentReelIndex) {
                    bar.style.width = '100%';
                } else {
                    bar.style.width = '0%';
                }
            });
        }
        
        // –°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        function simulateProgress() {
            setInterval(() => {
                if (reelsData.length === 0) return;
                
                const currentBar = document.querySelectorAll('.progress-fill')[currentReelIndex];
                if (currentBar) {
                    const currentWidth = parseFloat(currentBar.style.width) || 0;
                    if (currentWidth < 100) {
                        const reel = reelsData[currentReelIndex];
                        const duration = reel.duration || 15;
                        const increment = 100 / (duration * 10); // –û–±–Ω–æ–≤–ª—è–µ–º 10 —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É
                        currentBar.style.width = Math.min(currentWidth + increment, 100) + '%';
                    }
                }
            }, 100);
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª
        function formatNumber(num) {
            if (!num) return '0';
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ
        function togglePlay(button) {
            const reel = button.closest('.reel');
            const video = reel.querySelector('.video-element');
            const icon = button.querySelector('.play-icon');
            
            if (video.paused) {
                video.play();
                icon.textContent = '‚è∏Ô∏è';
            } else {
                video.pause();
                icon.textContent = '‚ñ∂Ô∏è';
            }
        }
        
        function restartVideo(button) {
            const reel = button.closest('.reel');
            const video = reel.querySelector('.video-element');
            video.currentTime = 0;
            video.play();
            
            const playButton = reel.querySelector('.play-icon');
            if (playButton) {
                playButton.textContent = '‚è∏Ô∏è';
            }
        }
        
        function toggleMute(button) {
            const reel = button.closest('.reel');
            const video = reel.querySelector('.video-element');
            const icon = button.querySelector('.mute-icon');
            
            if (video) {
                video.muted = !video.muted;
                icon.textContent = video.muted ? 'üîá' : 'üîä';
            }
        }
        
        // –õ–∞–π–∫ —Ä–∏–ª—Å–∞ —á–µ—Ä–µ–∑ API
        async function likeReel(button, reelId) {
            try {
                if (!currentUser) {
                    showError('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                    return;
                }
                
                // –î–ª—è –¥–µ–º–æ —Ä–∏–ª—Å–æ–≤ –ø—Ä–æ—Å—Ç–æ –º–µ–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ
                if (reelId.startsWith('demo-')) {
                    const countElement = button.querySelector('.action-count');
                    let currentCount = parseInt(countElement.textContent.replace(/[^0-9.]/g, '')) || 0;
                    const multiplier = countElement.textContent.includes('K') ? 1000 : 
                                      countElement.textContent.includes('M') ? 1000000 : 1;
                    
                    currentCount = currentCount * multiplier;
                    
                    if (button.classList.contains('liked')) {
                        button.classList.remove('liked');
                        currentCount--;
                    } else {
                        button.classList.add('liked');
                        currentCount++;
                        
                        // –ê–Ω–∏–º–∞—Ü–∏—è —Å–µ—Ä–¥–µ—á–∫–∞
                        const heartIcon = button.querySelector('.action-icon');
                        heartIcon.style.transform = 'scale(1.3)';
                        setTimeout(() => {
                            heartIcon.style.transform = 'scale(1)';
                        }, 200);
                    }
                    
                    countElement.textContent = formatNumber(currentCount);
                    return;
                }
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                const response = await fetch(`/api/reels/${reelId}/like`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ userId: currentUser.id })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const countElement = button.querySelector('.action-count');
                    
                    if (button.classList.contains('liked')) {
                        button.classList.remove('liked');
                    } else {
                        button.classList.add('liked');
                        
                        // –ê–Ω–∏–º–∞—Ü–∏—è —Å–µ—Ä–¥–µ—á–∫–∞
                        const heartIcon = button.querySelector('.action-icon');
                        heartIcon.style.transform = 'scale(1.3)';
                        setTimeout(() => {
                            heartIcon.style.transform = 'scale(1)';
                        }, 200);
                    }
                    
                    countElement.textContent = formatNumber(data.likes_count);
                    
                } else {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –ª–∞–π–∫–∞');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ª–∞–π–∫–∞:', error);
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ª–∞–π–∫–∞');
                
                // –õ–æ–∫–∞–ª—å–Ω—ã–π –ª–∞–π–∫ –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
                localLike(button, reelId);
            }
        }
        
        // –õ–æ–∫–∞–ª—å–Ω—ã–π –ª–∞–π–∫ (–∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç)
        function localLike(button, reelId) {
            const countElement = button.querySelector('.action-count');
            let currentCount = parseInt(countElement.textContent.replace(/[^0-9.]/g, '')) || 0;
            const multiplier = countElement.textContent.includes('K') ? 1000 : 
                              countElement.textContent.includes('M') ? 1000000 : 1;
            
            currentCount = currentCount * multiplier;
            
            if (button.classList.contains('liked')) {
                button.classList.remove('liked');
                currentCount--;
            } else {
                button.classList.add('liked');
                currentCount++;
                
                // –ê–Ω–∏–º–∞—Ü–∏—è —Å–µ—Ä–¥–µ—á–∫–∞
                const heartIcon = button.querySelector('.action-icon');
                heartIcon.style.transform = 'scale(1.3)';
                setTimeout(() => {
                    heartIcon.style.transform = 'scale(1)';
                }, 200);
            }
            
            countElement.textContent = formatNumber(currentCount);
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∏–ª—Å–∞
        function saveReel(button, reelId) {
            const icon = button.querySelector('.action-icon');
            
            if (icon.textContent === 'üì•') {
                icon.textContent = '‚úì';
                button.classList.add('liked');
                
                // –ê–Ω–∏–º–∞—Ü–∏—è
                icon.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    icon.style.transform = 'scale(1)';
                }, 200);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
                const saved = JSON.parse(localStorage.getItem('saved_reels') || '[]');
                if (!saved.includes(reelId)) {
                    saved.push(reelId);
                    localStorage.setItem('saved_reels', JSON.stringify(saved));
                }
                
            } else {
                icon.textContent = 'üì•';
                button.classList.remove('liked');
                
                // –£–¥–∞–ª—è–µ–º –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
                const saved = JSON.parse(localStorage.getItem('saved_reels') || '[]');
                const index = saved.indexOf(reelId);
                if (index > -1) {
                    saved.splice(index, 1);
                    localStorage.setItem('saved_reels', JSON.stringify(saved));
                }
            }
        }
        
        // –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–∏–ª—Å–æ–º
        function shareReel(reelId) {
            const reel = reelsData.find(r => r.id === reelId);
            if (!reel) return;
            
            const shareData = {
                title: reel.caption || 'Coolpep Reel',
                text: reel.caption || '–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —ç—Ç–æ—Ç Reel –≤ Coolpep!',
                url: window.location.origin + '/reels-feed.html?reel=' + reelId
            };
            
            if (navigator.share) {
                navigator.share(shareData).then(() => {
                    console.log('Reel —É—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω');
                }).catch(err => {
                    console.log('–û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:', err);
                    copyToClipboard(shareData.url);
                });
            } else {
                copyToClipboard(shareData.url);
            }
        }
        
        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
            }).catch(err => {
                console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É');
            });
        }
        
        // –û—Ç–∫—Ä—ã—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
        function openComments(reelId) {
            const panel = document.getElementById('commentsPanel');
            const commentsList = document.getElementById('commentsList');
            const commentInput = document.getElementById('commentInput');
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID —Ç–µ–∫—É—â–µ–≥–æ Reel
            panel.dataset.reelId = reelId;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
            const reelComments = comments[reelId] || [];
            commentsList.innerHTML = '';
            
            if (reelComments.length === 0) {
                commentsList.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; opacity: 0.7;">
                        <div style="font-size: 40px; margin-bottom: 15px;">üí¨</div>
                        <div>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</div>
                        <small>–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</small>
                    </div>
                `;
            } else {
                reelComments.forEach(comment => {
                    const commentItem = document.createElement('div');
                    commentItem.className = 'comment-item';
                    commentItem.innerHTML = `
                        <div class="comment-avatar">${comment.author.charAt(0)}</div>
                        <div class="comment-content">
                            <div class="comment-author">${comment.author}</div>
                            <div class="comment-text">${comment.text}</div>
                            <div class="comment-actions">
                                <button class="comment-action" onclick="likeComment(${comment.id}, '${reelId}')">‚ù§Ô∏è ${comment.likes}</button>
                                <button class="comment-action" onclick="replyToComment(${comment.id}, '${comment.author}')">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
                            </div>
                        </div>
                    `;
                    commentsList.appendChild(commentItem);
                });
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å
            panel.classList.add('active');
            setTimeout(() => {
                commentInput.focus();
            }, 300);
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
        function closeComments() {
            document.getElementById('commentsPanel').classList.remove('active');
            document.getElementById('commentInput').value = '';
        }
        
        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
        function sendComment() {
            const panel = document.getElementById('commentsPanel');
            const reelId = panel.dataset.reelId;
            const input = document.getElementById('commentInput');
            const text = input.value.trim();
            
            if (!text || !reelId) return;
            
            // –ü–æ–ª—É—á–∞–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const author = currentUser?.name || '–ê–Ω–æ–Ω–∏–º';
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
            const newComment = {
                id: Date.now(),
                author: author,
                text: text,
                likes: 0
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–ø–∏—Å–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
            if (!comments[reelId]) {
                comments[reelId] = [];
            }
            comments[reelId].push(newComment);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ —Å–ø–∏—Å–æ–∫
            const commentsList = document.getElementById('commentsList');
            
            // –£–±–∏—Ä–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ "–Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤"
            if (commentsList.innerHTML.includes('–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç')) {
                commentsList.innerHTML = '';
            }
            
            const commentItem = document.createElement('div');
            commentItem.className = 'comment-item';
            commentItem.innerHTML = `
                <div class="comment-avatar">${author.charAt(0)}</div>
                <div class="comment-content">
                    <div class="comment-author">${author}</div>
                    <div class="comment-text">${text}</div>
                    <div class="comment-actions">
                        <button class="comment-action" onclick="likeComment(${newComment.id}, '${reelId}')">‚ù§Ô∏è 0</button>
                        <button class="comment-action" onclick="replyToComment(${newComment.id}, '${author}')">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
                    </div>
                </div>
            `;
            commentsList.appendChild(commentItem);
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            input.value = '';
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–æ–≤–æ–º—É –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—é
            commentItem.scrollIntoView({ behavior: 'smooth' });
        }
        
        // –õ–∞–π–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        function likeComment(commentId, reelId) {
            const reelComments = comments[reelId];
            if (!reelComments) return;
            
            const comment = reelComments.find(c => c.id === commentId);
            if (comment) {
                comment.likes++;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                const commentItems = document.querySelectorAll('#commentsList .comment-item');
                const commentIndex = reelComments.indexOf(comment);
                
                if (commentIndex >= 0 && commentItems[commentIndex]) {
                    const likeButton = commentItems[commentIndex].querySelector('.comment-action');
                    if (likeButton) {
                        likeButton.textContent = `‚ù§Ô∏è ${comment.likes}`;
                        
                        // –ê–Ω–∏–º–∞—Ü–∏—è
                        likeButton.style.transform = 'scale(1.2)';
                        setTimeout(() => {
                            likeButton.style.transform = 'scale(1)';
                        }, 200);
                    }
                }
            }
        }
        
        // –û—Ç–≤–µ—Ç –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
        function replyToComment(commentId, author) {
            const input = document.getElementById('commentInput');
            input.value = `@${author} `;
            input.focus();
        }
        
        // –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function followUser(userId, username) {
            const button = event.target;
            
            // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–¥–ø–∏—Å–æ–∫
            const following = JSON.parse(localStorage.getItem('following') || '{}');
            
            if (following[userId]) {
                // –û—Ç–ø–∏—Å–∞—Ç—å—Å—è
                delete following[userId];
                button.textContent = '–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è';
                button.style.background = 'rgba(255,255,255,0.2)';
            } else {
                // –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è
                following[userId] = username;
                button.textContent = '‚úì –ü–æ–¥–ø–∏—Å–∫–∞';
                button.style.background = 'rgba(255,255,255,0.1)';
                
                // –ê–Ω–∏–º–∞—Ü–∏—è
                button.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    button.style.transform = 'scale(1)';
                }, 200);
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
            localStorage.setItem('following', JSON.stringify(following));
        }
        
        // –û—Ç–∫—Ä—ã—Ç—å –∫–∞–º–µ—Ä—É
        function openCamera() {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(() => {
                        window.location.href = 'upload-video.html';
                    })
                    .catch(() => {
                        showError('–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Reels —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ');
                    });
            } else {
                window.location.href = 'upload-video.html';
            }
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª–µ–π —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è –∫–ª–∞–≤–∏—à–∞–º–∏
            document.addEventListener('keydown', (e) => {
                switch(e.code) {
                    case 'ArrowDown':
                        e.preventDefault();
                        scrollToReel(currentReelIndex + 1);
                        break;
                    case 'ArrowUp':
                        e.preventDefault();
                        scrollToReel(currentReelIndex - 1);
                        break;
                    case 'Space':
                        e.preventDefault();
                        if (playingVideo) {
                            playingVideo.paused ? playingVideo.play() : playingVideo.pause();
                        }
                        break;
                    case 'KeyM':
                        e.preventDefault();
                        if (playingVideo) {
                            playingVideo.muted = !playingVideo.muted;
                        }
                        break;
                }
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ
            document.addEventListener('click', (e) => {
                const panel = document.getElementById('commentsPanel');
                if (panel.classList.contains('active') && 
                    !panel.contains(e.target) && 
                    !e.target.closest('.action-button:nth-child(2)')) {
                    closeComments();
                }
            });
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –ø–æ Enter
            document.getElementById('commentInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendComment();
                }
            });
            
            // –ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞
            const container = document.getElementById('reelsContainer');
            
            container.addEventListener('scroll', () => {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∏–≥–ª–∏ –ª–∏ –∫–æ–Ω—Ü–∞
                const scrollPosition = container.scrollTop + container.clientHeight;
                const scrollHeight = container.scrollHeight;
                
                if (scrollHeight - scrollPosition < 100) {
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –µ—â–µ Reels
                    loadReelsFromAPI();
                }
            });
            
            // –°–≤–∞–π–ø—ã –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
            let startY;
            container.addEventListener('touchstart', (e) => {
                startY = e.touches[0].clientY;
            });
            
            container.addEventListener('touchend', (e) => {
                const endY = e.changedTouches[0].clientY;
                const diff = startY - endY;
                
                if (Math.abs(diff) > 50) {
                    if (diff > 0) {
                        // –°–≤–∞–π–ø –≤–≤–µ—Ä—Ö
                        scrollToReel(currentReelIndex + 1);
                    } else {
                        // –°–≤–∞–π–ø –≤–Ω–∏–∑
                        scrollToReel(currentReelIndex - 1);
                    }
                }
            });
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∏–º—É–ª—è—Ü–∏—é –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            simulateProgress();
        }
        
        // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —Ä–∏–ª—Å—É
        function scrollToReel(index) {
            if (index >= 0 && index < reelsData.length) {
                const reels = document.querySelectorAll('.reel');
                if (reels[index]) {
                    reels[index].scrollIntoView({ behavior: 'smooth' });
                    currentReelIndex = index;
                    updateProgressBar();
                }
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ö—ç—à—Ç–µ–≥–æ–≤
        function processHashtags(text) {
            return text.replace(/#(\w+)/g, '<span class="hashtag" onclick="searchHashtag(\'$1\')">#$1</span>');
        }
        
        // –ü–æ–∏—Å–∫ –ø–æ —Ö—ç—à—Ç–µ–≥—É
        function searchHashtag(hashtag) {
            alert(`–ü–æ–∏—Å–∫ –ø–æ —Ö—ç—à—Ç–µ–≥—É: #${hashtag}`);
            // –í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ö—ç—à—Ç–µ–≥–æ–≤
        function setupHashtagDetection() {
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–ª–∏–∫–∏ –ø–æ —Ö—ç—à—Ç–µ–≥–∞–º
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('hashtag')) {
                    const hashtag = e.target.textContent.substring(1);
                    searchHashtag(hashtag);
                }
            });
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
        function showError(message) {
            const errorElement = document.getElementById('errorMessage');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            
            setTimeout(() => {
                errorElement.style.display = 'none';
            }, 3000);
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        function showLoading() {
            document.getElementById('loadingIndicator').style.display = 'block';
        }
        
        // –°–∫—Ä—ã—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        function hideLoading() {
            document.getElementById('loadingIndicator').style.display = 'none';
        }
        
        // –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ Reels
        function showNoReelsMessage() {
            const container = document.getElementById('reelsContainer');
            container.innerHTML = `
                <div style="
                    height: 100vh;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    text-align: center;
                    padding: 20px;
                ">
                    <div style="font-size: 60px; margin-bottom: 20px;">üé¨</div>
                    <h2 style="margin-bottom: 15px;">–ü–æ–∫–∞ –Ω–µ—Ç Reels</h2>
                    <p style="margin-bottom: 30px; opacity: 0.8; max-width: 300px;">
                        –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –∑–∞–≥—Ä—É–∑–∏—Ç Reel!
                    </p>
                    <a href="upload-video.html" style="
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        padding: 15px 30px;
                        border-radius: 10px;
                        text-decoration: none;
                        font-weight: 600;
                        font-size: 16px;
                    ">
                        üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–≤—ã–π Reel
                    </a>
                    <button onclick="loadDemoReels()" style="
                        background: rgba(255,255,255,0.1);
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 8px;
                        margin-top: 15px;
                        cursor: pointer;
                        font-size: 14px;
                    ">
                        üé≠ –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ–º–æ –∫–æ–Ω—Ç–µ–Ω—Ç
                    </button>
                </div>
            `;
        }
    </script>
</body>
</html>
